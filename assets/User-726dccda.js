import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-9e93c95d.js";import{d as a,q as t,e as l,F as r,r as o,M as s,a as i,o as n,c as d,w as u,f as m,t as p,A as c,L as f,i as v,Q as _,K as h,k as g,N as j}from"./index-7477c05f.js";import{_ as y}from"./Table.vue_vue_type_script_lang-2ee8e79d.js";import{E as b}from"./el-button-124be40d.js";import{d as x}from"./Form-b12ebed4.js";import"./tsxHelper-16c14f77.js";import{E as D}from"./el-input-10c0bbfb.js";import{E as w}from"./el-divider-8c08a602.js";import{g as k,b as C,c as S,e as E}from"./index-2fdccfc4.js";import{u as N}from"./useTable-ffff88e6.js";import{_ as R}from"./Search.vue_vue_type_script_setup_true_lang-043528c0.js";import{_ as V}from"./Write.vue_vue_type_script_setup_true_lang-11a66d3a.js";import{_ as z}from"./Detail.vue_vue_type_script_setup_true_lang-2c6e61a4.js";import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-8294603f.js";import{u as T}from"./useCrudSchemas-2605178a.js";import"./el-card-0fcbb5fa.js";import"./el-popper-a621f9bb.js";import"./constants-734cca61.js";import"./el-tag-1a2ededc.js";import"./use-form-common-props-3de26c1f.js";import"./el-image-viewer-8d6ac280.js";import"./debounce-ed510409.js";import"./el-dropdown-item-bc721e0c.js";import"./refs-100ac577.js";import"./use-form-item-5dfce446.js";import"./el-col-391f73f2.js";import"./el-input-number-59433400.js";import"./InputPassword-23b379fe.js";import"./style.css_vue_type_style_index_0_src_true_lang-3200f5e6.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-ea7fc409.js";import"./aria-ecee1d93.js";import"./index-394fdc52.js";import"./index-7c8c370b.js";import"./el-message-box-e13147aa.js";import"./el-overlay-ea4574e8.js";import"./vnode-abc17e97.js";import"./useForm-882c078b.js";import"./useIcon-623a852a.js";import"./useValidator-08c6d7fe.js";import"./Descriptions-0a148d97.js";import"./tree-b59d36bb.js";const I={class:"flex w-100% h-100%"},P={class:"flex justify-center items-center"},U={class:"flex-1"},A={class:"mb-10px"};function K(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)}const F=a({__name:"User",setup(a){const{t:h}=g(),{tableRegister:F,tableState:M,tableMethods:q}=N({fetchDataApi:async()=>{const{pageSize:e,currentPage:a}=M,t=await C({id:i(te),pageIndex:i(a),pageSize:i(e),...i(Z)});return{list:t.data.list||[],total:t.data.total||0}},fetchDelApi:async()=>!!(await S(i(ce)))}),{total:H,loading:J,dataList:O,pageSize:Q,currentPage:W}=M,{getList:G,getElTableExpose:Y,delList:$}=q,B=t([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:h("userDemo.index"),form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:h("userDemo.username")},{field:"account",label:h("userDemo.account")},{field:"department.id",label:h("userDemo.department"),detail:{slots:{default:e=>l(r,null,[e.department.departmentName])}},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:async()=>(await k()).data.list},table:{type:"index"}},{field:"role",label:h("userDemo.role"),search:{hidden:!0}},{field:"email",label:h("userDemo.email"),form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:h("userDemo.createTime"),form:{component:"Input"},search:{hidden:!0}},{field:"action",label:h("userDemo.action"),form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:e=>{let a,t,o;const s=e.row;return l(r,null,[l(b,{type:"primary",onClick:()=>ve(s,"edit")},K(a=h("exampleDemo.edit"))?a:{default:()=>[a]}),l(b,{type:"success",onClick:()=>ve(s,"detail")},K(t=h("exampleDemo.detail"))?t:{default:()=>[t]}),l(b,{type:"danger",onClick:()=>fe(s)},K(o=h("exampleDemo.del"))?o:{default:()=>[o]})])}}}}]),{allSchemas:X}=T(B),Z=o({}),ee=e=>{W.value=1,Z.value=e,G()},ae=o(),te=o(""),le=o([]);(async()=>{var e,a;const t=await k();le.value=t.data.list,te.value=t.data.list[0]&&(null==(e=t.data.list[0])?void 0:e.children)&&t.data.list[0].children[0].id||"",await j(),null==(a=i(ae))||a.setCurrentKey(te.value)})();const re=o("");s((()=>re.value),(e=>{i(ae).filter(e)}));const oe=e=>{e.children||(te.value=e.id,W.value=1,G())},se=(e,a)=>!e||a.departmentName.includes(e),ie=o(!1),ne=o(""),de=o(),ue=o(""),me=()=>{ne.value=h("exampleDemo.add"),de.value=void 0,ie.value=!0,ue.value=""},pe=o(!1),ce=o([]),fe=async e=>{const a=await Y();ce.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],pe.value=!0,await $(i(ce).length).finally((()=>{pe.value=!1}))},ve=(e,a)=>{var t;ne.value=h("edit"===a?"exampleDemo.edit":"exampleDemo.detail"),ue.value=a,de.value={...e,department:(null==(t=i(ae))?void 0:t.getCurrentNode())||{}},ie.value=!0},_e=o(),he=o(!1),ge=async()=>{const e=i(_e),a=await(null==e?void 0:e.submit());if(a){he.value=!0;try{await E(a)&&(W.value=1,G())}catch(t){}finally{he.value=!1,ie.value=!1}}};return(a,t)=>(n(),d("div",I,[l(i(e),{class:"flex-1"},{default:u((()=>[m("div",P,[m("div",U,p(i(h)("userDemo.departmentList")),1),l(i(D),{modelValue:re.value,"onUpdate:modelValue":t[0]||(t[0]=e=>re.value=e),class:"flex-[2]",placeholder:i(h)("userDemo.searchDepartment"),clearable:""},null,8,["modelValue","placeholder"])]),l(i(w)),l(i(x),{ref_key:"treeEl",ref:ae,data:le.value,"default-expand-all":"","node-key":"id","current-node-key":te.value,props:{label:"departmentName"},"filter-node-method":se,onCurrentChange:oe},null,8,["data","current-node-key"])])),_:1}),l(i(e),{class:"flex-[3] ml-20px"},{default:u((()=>[l(i(R),{schema:i(X).searchSchema,onReset:ee,onSearch:ee},null,8,["schema"]),m("div",A,[l(i(b),{type:"primary",onClick:me},{default:u((()=>[c(p(i(h)("exampleDemo.add")),1)])),_:1}),l(i(b),{loading:pe.value,type:"danger",onClick:t[1]||(t[1]=e=>fe())},{default:u((()=>[c(p(i(h)("exampleDemo.del")),1)])),_:1},8,["loading"])]),l(i(y),{"current-page":i(W),"onUpdate:currentPage":t[2]||(t[2]=e=>f(W)?W.value=e:null),"page-size":i(Q),"onUpdate:pageSize":t[3]||(t[3]=e=>f(Q)?Q.value=e:null),columns:i(X).tableColumns,data:i(O),loading:i(J),onRegister:i(F),pagination:{total:i(H)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])])),_:1}),l(i(L),{modelValue:ie.value,"onUpdate:modelValue":t[5]||(t[5]=e=>ie.value=e),title:ne.value},{footer:u((()=>["detail"!==ue.value?(n(),v(i(b),{key:0,type:"primary",loading:he.value,onClick:ge},{default:u((()=>[c(p(i(h)("exampleDemo.save")),1)])),_:1},8,["loading"])):_("",!0),l(i(b),{onClick:t[4]||(t[4]=e=>ie.value=!1)},{default:u((()=>[c(p(i(h)("dialogDemo.close")),1)])),_:1})])),default:u((()=>["detail"!==ue.value?(n(),v(V,{key:0,ref_key:"writeRef",ref:_e,"form-schema":i(X).formSchema,"current-row":de.value},null,8,["form-schema","current-row"])):_("",!0),"detail"===ue.value?(n(),v(z,{key:1,"detail-schema":i(X).detailSchema,"current-row":de.value},null,8,["detail-schema","current-row"])):_("",!0)])),_:1},8,["modelValue","title"])]))}});export{F as default};
