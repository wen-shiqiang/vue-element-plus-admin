import{bV as e,ab as a,ad as s,bf as n,aU as t,d as l,bj as o,cV as i,cW as c,aM as u,ah as r,cn as d,r as f,cX as v,b3 as m,x as p,M as b,N as g,D as k,o as w,i as x,e as I,w as _,f as h,n as z,a as C,W as y,aE as O,Q as N,H as T,b6 as A,c as X,F as E,bb as L,aX as R,cY as Y,bx as $,$ as B,cZ as F,c_ as M,B as W,Z as j,b1 as D,al as V,h as P,co as S,am as Z,br as H,aP as G,c$ as Q,aw as U}from"./index-7477c05f.js";import{d as q}from"./debounce-ed510409.js";function J(a,s,n){var t=!0,l=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return e(n)&&(t="leading"in n?!!n.leading:t,l="trailing"in n?!!n.trailing:l),q(a,s,{leading:t,maxWait:s,trailing:l})}const K=a({urlList:{type:s(Array),default:()=>n([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),ee={close:()=>!0,switch:e=>t(e)},ae=["src"],se=l({name:"ElImageViewer"});const ne=U(Z(l({...se,props:K,emits:ee,setup(e,{expose:a,emit:s}){const n=e,l={CONTAIN:{name:"contain",icon:o(i)},ORIGINAL:{name:"original",icon:o(c)}},{t:Z}=u(),U=r("image-viewer"),{nextZIndex:q}=d(),K=f(),ee=f([]),se=v(),ne=f(!0),te=f(n.initialIndex),le=m(l.CONTAIN),oe=f({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ie=p((()=>{const{urlList:e}=n;return e.length<=1})),ce=p((()=>0===te.value)),ue=p((()=>te.value===n.urlList.length-1)),re=p((()=>n.urlList[te.value])),de=p((()=>[U.e("btn"),U.e("prev"),U.is("disabled",!n.infinite&&ce.value)])),fe=p((()=>[U.e("btn"),U.e("next"),U.is("disabled",!n.infinite&&ue.value)])),ve=p((()=>{const{scale:e,deg:a,offsetX:s,offsetY:n,enableTransition:t}=oe.value;let o=s/e,i=n/e;switch(a%360){case 90:case-270:[o,i]=[i,-o];break;case 180:case-180:[o,i]=[-o,-i];break;case 270:case-90:[o,i]=[-i,o]}const c={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${i}px)`,transition:t?"transform .3s":""};return le.value.name===l.CONTAIN.name&&(c.maxWidth=c.maxHeight="100%"),c})),me=p((()=>t(n.zIndex)?n.zIndex:q()));function pe(){se.stop(),s("close")}function be(){ne.value=!1}function ge(e){ne.value=!1,e.target.alt=Z("el.image.error")}function ke(e){if(ne.value||0!==e.button||!K.value)return;oe.value.enableTransition=!1;const{offsetX:a,offsetY:s}=oe.value,n=e.pageX,t=e.pageY,l=J((e=>{oe.value={...oe.value,offsetX:a+e.pageX-n,offsetY:s+e.pageY-t}})),o=H(document,"mousemove",l);H(document,"mouseup",(()=>{o()})),e.preventDefault()}function we(){oe.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function xe(){if(ne.value)return;const e=Q(l),a=Object.values(l),s=le.value.name,n=(a.findIndex((e=>e.name===s))+1)%e.length;le.value=l[e[n]],we()}function Ie(e){const a=n.urlList.length;te.value=(e+a)%a}function _e(){ce.value&&!n.infinite||Ie(te.value-1)}function he(){ue.value&&!n.infinite||Ie(te.value+1)}function ze(e,a={}){if(ne.value)return;const{zoomRate:s,rotateDeg:t,enableTransition:l}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":oe.value.scale>.2&&(oe.value.scale=Number.parseFloat((oe.value.scale/s).toFixed(3)));break;case"zoomIn":oe.value.scale<7&&(oe.value.scale=Number.parseFloat((oe.value.scale*s).toFixed(3)));break;case"clockwise":oe.value.deg+=t;break;case"anticlockwise":oe.value.deg-=t}oe.value.enableTransition=l}return b(re,(()=>{g((()=>{const e=ee.value[0];(null==e?void 0:e.complete)||(ne.value=!0)}))})),b(te,(e=>{we(),s("switch",e)})),k((()=>{var e,a;!function(){const e=J((e=>{switch(e.code){case G.esc:n.closeOnPressEscape&&pe();break;case G.space:xe();break;case G.left:_e();break;case G.up:ze("zoomIn");break;case G.right:he();break;case G.down:ze("zoomOut")}})),a=J((e=>{ze((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})}));se.run((()=>{H(document,"keydown",e),H(document,"wheel",a)}))}(),null==(a=null==(e=K.value)?void 0:e.focus)||a.call(e)})),a({setActiveItem:Ie}),(e,a)=>(w(),x(S,{to:"body",disabled:!e.teleported},[I(P,{name:"viewer-fade",appear:""},{default:_((()=>[h("div",{ref_key:"wrapper",ref:K,tabindex:-1,class:z(C(U).e("wrapper")),style:y({zIndex:C(me)})},[h("div",{class:z(C(U).e("mask")),onClick:a[0]||(a[0]=O((a=>e.hideOnClickModal&&pe()),["self"]))},null,2),N(" CLOSE "),h("span",{class:z([C(U).e("btn"),C(U).e("close")]),onClick:pe},[I(C(T),null,{default:_((()=>[I(C(A))])),_:1})],2),N(" ARROW "),C(ie)?N("v-if",!0):(w(),X(E,{key:0},[h("span",{class:z(C(de)),onClick:_e},[I(C(T),null,{default:_((()=>[I(C(L))])),_:1})],2),h("span",{class:z(C(fe)),onClick:he},[I(C(T),null,{default:_((()=>[I(C(R))])),_:1})],2)],64)),N(" ACTIONS "),h("div",{class:z([C(U).e("btn"),C(U).e("actions")])},[h("div",{class:z(C(U).e("actions__inner"))},[I(C(T),{onClick:a[1]||(a[1]=e=>ze("zoomOut"))},{default:_((()=>[I(C(Y))])),_:1}),I(C(T),{onClick:a[2]||(a[2]=e=>ze("zoomIn"))},{default:_((()=>[I(C($))])),_:1}),h("i",{class:z(C(U).e("actions__divider"))},null,2),I(C(T),{onClick:xe},{default:_((()=>[(w(),x(B(C(le).icon)))])),_:1}),h("i",{class:z(C(U).e("actions__divider"))},null,2),I(C(T),{onClick:a[3]||(a[3]=e=>ze("anticlockwise"))},{default:_((()=>[I(C(F))])),_:1}),I(C(T),{onClick:a[4]||(a[4]=e=>ze("clockwise"))},{default:_((()=>[I(C(M))])),_:1})],2)],2),N(" CANVAS "),h("div",{class:z(C(U).e("canvas"))},[(w(!0),X(E,null,W(e.urlList,((e,a)=>j((w(),X("img",{ref_for:!0,ref:e=>ee.value[a]=e,key:e,src:e,style:y(C(ve)),class:z(C(U).e("img")),onLoad:be,onError:ge,onMousedown:ke},null,46,ae)),[[D,a===te.value]]))),128))],2),V(e.$slots,"default")],6)])),_:3})],8,["disabled"]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]));export{ne as E};
